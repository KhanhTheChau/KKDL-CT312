<!DOCTYPE html>
<html lang="vi">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>H·ªá Th·ªëng D·ª± ƒêo√°n Ph√¢n Lo·∫°i H·∫°t ƒê·∫≠u</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
        // C·∫•u h√¨nh Tailwind CSS: S·ª≠ d·ª•ng Font Inter v√† m√†u s·∫Øc t√πy ch·ªânh
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#4f46e5', // Indigo 600
                        'secondary': '#6366f1', // Indigo 500
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
        
        // H·∫°n ch·∫ø ng∆∞·ªùi d√πng nh·∫≠p gi√° tr·ªã √¢m
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', (e) => {
                    if (e.target.value < 0) {
                        e.target.value = 0;
                    }
                });
            });
        });
    </script>
        <!-- Import Google Font Inter -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
            rel="stylesheet">
    </head>

    <body
        class="p-4 sm:p-8 min-h-screen bg-gray-50 flex items-start justify-center font-sans">

        <div class="w-full max-w-7xl">

            <h1
                class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-2 text-center">
                H·ªá Th·ªëng D·ª± ƒêo√°n Ph√¢n Lo·∫°i H·∫°t ƒê·∫≠u
            </h1>
            <p class="text-center text-gray-500 mb-8 sm:mb-12">
                Nh·∫≠p c√°c thu·ªôc t√≠nh h√¨nh th√°i h·ªçc ƒë·ªÉ ch·∫°y d·ª± ƒëo√°n ph√¢n lo·∫°i lo·∫°i
                ƒë·∫≠u
                (Bean Class).
            </p>

            <!-- Kh·ªëi ch·ª©a th√¥ng b√°o (s·ª≠ d·ª•ng Jinja/Template Engine) -->
            {% if message %}
            {% set is_error = 'L·ªñI' in message %}
            <!-- Message Box (Success/Alert) -->
            <div id="message-box"
                class="relative border-l-4 p-4 mb-6 rounded-lg shadow-md
                {% if is_error %} 
                    bg-red-100 border-red-500 text-red-700 
                {% else %} 
                    bg-green-100 border-green-500 text-green-700 
                {% endif %}"
                role="alert">
                <p class="font-bold">
                    {% if is_error %} L·ªói X·∫£y Ra! {% else %} Ho√†n Th√†nh! {%
                    endif %}
                </p>
                <p class="mt-1">{{ message }}</p>
                <button
                    onclick="document.getElementById('message-box').style.display='none'"
                    class="absolute top-0 right-0 mt-2 mr-4 font-semibold text-lg
                {% if is_error %} text-red-700 hover:text-red-900 {% else %} text-green-700 hover:text-green-900 {% endif %}"
                    aria-label="Close">
                    &times;
                </button>
            </div>
            {% endif %}

            <!-- THAY ƒê·ªîI: Th√™m enctype="multipart/form-data" ƒë·ªÉ g·ª≠i file -->
            <form method="POST" action="/" enctype="multipart/form-data"
                class="flex flex-col md:flex-row gap-8">

                <div
                    class="md:w-3/4 bg-white shadow-xl rounded-2xl p-6 sm:p-8 border border-gray-100">

                    <!-- CH·ª®C NƒÇNG T·∫£i l√™n CSV -->
                    <div class="mb-8 border-b pb-4">
                        <label for="csv_file"
                            class="block text-xl font-semibold text-gray-800 mb-3 flex items-center">
                            <!-- Icon File CSV (Inline SVG) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20"
                                height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-file-text mr-2 text-primary">
                                <path
                                    d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" />
                                <path d="M14 2v4a2 2 0 0 0 2 2h4" />
                                <path d="M10 9H8" />
                                <path d="M16 13H8" />
                                <path d="M16 17H8" />
                            </svg>
                            T·∫£i L√™n D·ªØ Li·ªáu T·ª´ T·ªáp CSV (T√πy Ch·ªçn)
                        </label>
                        <input type="file" id="csv_file" name="csv_file"
                            accept=".csv"
                            class="block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 cursor-pointer">
                        <p class="text-xs text-gray-500 mt-2">D·ªØ li·ªáu trong t·ªáp
                            CSV s·∫Ω ƒë∆∞·ª£c ∆∞u ti√™n n·∫øu ƒë∆∞·ª£c t·∫£i l√™n. N·∫øu th√†nh
                            c√¥ng, k·∫øt
                            qu·∫£ d·ª± ƒëo√°n s·∫Ω ƒë∆∞·ª£c tr·∫£ v·ªÅ d∆∞·ªõi d·∫°ng t·ªáp CSV.</p>

                        <!-- THAY ƒê·ªîI: Checkbox cho Ti√™u ƒë·ªÅ CSV -->
                        <div class="mt-3 flex items-center">
                            <input type="checkbox" id="csv_has_header"
                                name="csv_has_header"
                                class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-secondary"
                                {% if data and data['csv_has_header'] == 'on'
                                %}checked{% endif %}>
                            <label for="csv_has_header"
                                class="ml-2 block text-sm font-medium text-gray-700">
                                T·ªáp CSV c·ªßa t√¥i c√≥ ch·ª©a d√≤ng ti√™u ƒë·ªÅ (Header
                                Row)
                            </label>
                        </div>
                        <!-- K·∫øt th√∫c Checkbox -->

                    </div>
                    <!-- K·∫øt th√∫c CH·ª®C NƒÇNG T·∫£i l√™n CSV -->

                    <!-- Ti√™u ƒë·ªÅ cho c√°c tr∆∞·ªùng nh·∫≠p th·ªß c√¥ng -->
                    <h2
                        class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-3">
                        1. Ho·∫∑c Nh·∫≠p C√°c Thu·ªôc T√≠nh H√¨nh H·ªçc (Th·ªß C√¥ng)
                    </h2>

                    <div
                        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

                        <!-- ƒê·ªãnh nghƒ©a c√°c thu·ªôc t√≠nh (s·ª≠ d·ª•ng Jinja/Template Engine) -->
                        {% set fields = [
                        ('Area', 'Di·ªán T√≠ch', 'mm¬≤',
                        'Di·ªán t√≠ch c·ªßa h·∫°t ƒë·∫≠u (s·ªë pixel).'),
                        ('Perimeter', 'Chu Vi', 'mm',
                        'ƒê·ªô d√†i chu vi c·ªßa h·∫°t ƒë·∫≠u.'),
                        ('MajorAxisLength', 'Chi·ªÅu D√†i Tr·ª•c Ch√≠nh', 'mm',
                        'Tr·ª•c d√†i nh·∫•t c√≥ th·ªÉ ƒë∆∞·ª£c v·∫Ω t·ª´ c√°c ƒëi·ªÉm ƒë·ªëi di·ªán c·ªßa h·∫°t ƒë·∫≠u.'),
                        ('MinorAxisLength', 'Chi·ªÅu D√†i Tr·ª•c Ph·ª•', 'mm',
                        'Tr·ª•c ng·∫Øn nh·∫•t vu√¥ng g√≥c v·ªõi tr·ª•c ch√≠nh.'),
                        ('AspectRation', 'T·ª∑ L·ªá Kh√≠a C·∫°nh', 'T·ª∑ l·ªá (Ratio)',
                        'T·ª∑ l·ªá c·ªßa MajorAxisLength tr√™n MinorAxisLength.'),
                        ('Eccentricity', 'ƒê·ªô L·ªách T√¢m', 'T·ª∑ l·ªá (Ratio)',
                        'ƒê·ªô l·ªách t√¢m h√¨nh elip. G·∫ßn 1 l√† h√¨nh d√†i, g·∫ßn 0 l√† h√¨nh tr√≤n.'),
                        ('ConvexArea', 'Di·ªán T√≠ch L·ªìi', 'mm¬≤',
                        'Di·ªán t√≠ch c·ªßa bao l·ªìi (convex hull) c·ªßa h·∫°t ƒë·∫≠u.'),
                        ('EquivDiameter', 'ƒê∆∞·ªùng K√≠nh T∆∞∆°ng ƒê∆∞∆°ng', 'mm',
                        'ƒê∆∞·ªùng k√≠nh c·ªßa m·ªôt v√≤ng tr√≤n c√≥ di·ªán t√≠ch b·∫±ng di·ªán t√≠ch h·∫°t ƒë·∫≠u.'),
                        ('Extent', 'M·ª©c ƒê·ªô', 'T·ª∑ l·ªá (Ratio)',
                        'T·ª∑ l·ªá c·ªßa di·ªán t√≠ch h·∫°t ƒë·∫≠u so v·ªõi di·ªán t√≠ch h√¨nh ch·ªØ nh·∫≠t bao quanh nh·ªè nh·∫•t.'),
                        ('Solidity', 'ƒê·ªô ƒê·∫∑c', 'T·ª∑ l·ªá (Ratio)',
                        'T·ª∑ l·ªá c·ªßa Area tr√™n ConvexArea. ƒêo l∆∞·ªùng m·ª©c ƒë·ªô ƒë·∫∑c c·ªßa h·∫°t.'),
                        ('roundness', 'ƒê·ªô Tr√≤n', 'T·ª∑ l·ªá (Ratio)',
                        'ƒêo l∆∞·ªùng ƒë·ªô tr√≤n c·ªßa h·∫°t ƒë·∫≠u, t√≠nh to√°n t·ª´ di·ªán t√≠ch v√† chi·ªÅu d√†i tr·ª•c ch√≠nh.'),
                        ('Compactness', 'ƒê·ªô Ch·∫∑t', 'T·ª∑ l·ªá (Ratio)',
                        'ƒêo l∆∞·ªùng m·ª©c ƒë·ªô ch·∫∑t c·ªßa h√¨nh d·∫°ng, t√≠nh to√°n d·ª±a tr√™n chu vi v√† di·ªán t√≠ch.'),
                        ('ShapeFactor1', 'H·ªá S·ªë H√¨nh D·∫°ng 1', 'T·ª∑ l·ªá (Ratio)',
                        'Y·∫øu t·ªë h√¨nh d·∫°ng d·ª±a tr√™n Area v√† MajorAxisLength.'),
                        ('ShapeFactor2', 'H·ªá S·ªë H√¨nh D·∫°ng 2', 'T·ª∑ l·ªá (Ratio)',
                        'Y·∫øu t·ªë h√¨nh d·∫°ng d·ª±a tr√™n t·ª∑ l·ªá MinorAxisLength / MajorAxisLength.'),
                        ('ShapeFactor3', 'H·ªá S·ªë H√¨nh D·∫°ng 3', 'T·ª∑ l·ªá (Ratio)',
                        'Y·∫øu t·ªë h√¨nh d·∫°ng d·ª±a tr√™n cƒÉn b·∫≠c hai c·ªßa Area v√† MajorAxisLength.'),
                        ('ShapeFactor4', 'H·ªá S·ªë H√¨nh D·∫°ng 4', 'T·ª∑ l·ªá (Ratio)',
                        'Y·∫øu t·ªë h√¨nh d·∫°ng d·ª±a tr√™n EquivDiameter v√† MajorAxisLength.')
                        ] %}

                        {% for name, label, unit, tooltip_text in fields %}
                        <!-- B·∫Øt ƒë·∫ßu div cha v·ªõi class group ƒë·ªÉ k√≠ch ho·∫°t hover -->
                        <div class="group relative">
                            <label for="{{ name }}"
                                class="flex items-center text-sm font-medium text-gray-700 mb-1">
                                <!-- Hi·ªÉn th·ªã t√™n ti·∫øng Anh (theo y√™u c·∫ßu) -->
                                {{ name }}

                                <!-- Tooltip Trigger -->
                                <span
                                    class="ml-1 relative inline-block cursor-help">
                                    <!-- Help Circle Icon (Inline SVG) -->
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                        width="16" height="16"
                                        viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="lucide lucide-help-circle text-gray-400 hover:text-secondary transition duration-150">
                                        <circle cx="12" cy="12" r="10" />
                                        <path
                                            d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                                        <path d="M12 17h.01" />
                                    </svg>

                                    <!-- Tooltip Content -->
                                    <span
                                        class="absolute z-20 w-64 p-3 mt-1 -ml-32 left-1/2 text-xs text-white bg-gray-800/95 rounded-lg shadow-xl 
                                ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† opacity-0 invisible transition-all duration-300 transform translate-y-2 
                                ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† group-hover:opacity-100 group-hover:visible group-hover:translate-y-0">
                                        <!-- Th√™m t√™n ti·∫øng Vi·ªát v√† ƒê∆°n v·ªã v√†o tooltip -->
                                        <span
                                            class="font-bold block mb-1 text-primary">{{
                                            label }} ({{ unit }})</span>
                                        {{ tooltip_text }}
                                    </span>
                                </span>
                            </label>
                            <input type="number" step="any" id="{{ name }}"
                                name="{{ name }}"
                                placeholder="Nh·∫≠p gi√° tr·ªã..."
                                value="{{ data[name] if data and data[name] is not none else '' }}"
                                min="0"
                                {% if name not in ['csv_file'] %} required {%
                                endif %}
                                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary transition duration-150 ease-in-out hover:border-secondary">
                        </div>
                        {% endfor %}

                    </div>
                </div>

                <div class="md:w-1/4 flex flex-col space-y-8">

                    <!-- H·ªôp 2: Ch·ªçn M√¥ H√¨nh -->
                    <div
                        class="bg-white shadow-xl rounded-2xl p-6 border border-gray-100">
                        <h2
                            class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-3">2.
                            L·ª±a Ch·ªçn M√¥ H√¨nh</h2>

                        <label for="model_name"
                            class="block text-sm font-medium text-gray-700 mb-2">
                            Ch·ªçn M√¥ H√¨nh D·ª± ƒêo√°n:
                        </label>
                        <select id="model_name" name="model_name" required
                            class="block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary transition duration-150 ease-in-out">
                            <option value="KNeighbors" {% if data and
                                data['model_name'] == 'KNeighbors' %}selected{%
                                endif %}>K L√°ng Gi·ªÅng G·∫ßn Nh·∫•t (KNN)</option>
                            <option value="NaiveBayes" {% if data and
                                data['model_name'] == 'NaiveBayes' %}selected{%
                                endif %}>Naive Bayes</option>
                            <option value="LogisticRegression" {% if data and
                                data['model_name'] == 'LogisticRegression'
                                %}selected{% endif %}>H·ªìi quy Logistic</option>
                            <option value="RandomForest" {% if data and
                                data['model_name'] == 'RandomForest'
                                %}selected{% endif %}>R·ª´ng Ng·∫´u Nhi√™n</option>
                            <option value="SupportVectorMachine" {% if data and
                                data['model_name'] == 'SupportVectorMachine'
                                %}selected{% endif %}>M√°y Vector H·ªó Tr·ª£
                                (SVM)</option>
                        </select>

                        <!-- N√∫t G·ª≠i/D·ª± ƒêo√°n -->
                        <button type="submit"
                            class="w-full mt-6 px-4 py-3 bg-primary text-white font-semibold rounded-xl shadow-lg hover:bg-secondary focus:outline-none focus:ring-4 focus:ring-secondary focus:ring-opacity-50 transition duration-300 transform hover:scale-[1.01] flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round"
                                    stroke-linejoin="round" stroke-width="2"
                                    d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            Ch·∫°y D·ª± ƒêo√°n
                        </button>
                    </div>

                    <!-- H·ªôp 3: K·∫øt Qu·∫£ D·ª± ƒêo√°n -->
                    <div
                        class="bg-white shadow-xl rounded-2xl p-6 border border-gray-100 flex-grow">
                        <h2
                            class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-3">3.
                            K·∫øt Qu·∫£ D·ª± ƒêo√°n</h2>

                        {% if prediction_result %}
                        <div class="space-y-4">
                            <p class="text-sm text-gray-600">M√¥ h√¨nh ƒë√£ s·ª≠
                                d·ª•ng:</p>
                            <p class="text-xl font-bold text-primary">{{
                                data['model_name'] }}</p>

                            <p
                                class="text-sm text-gray-600 border-t pt-4 mt-4">K·∫øt
                                qu·∫£ d·ª± ƒëo√°n <span class="text-2xl">üëâ</span></p>

                            <!-- HI·ªÇN TH·ªä K·∫æT QU·∫¢ D·ª∞ ƒêO√ÅN (Tr∆∞·ªùng h·ª£p nh·∫≠p tay th√†nh c√¥ng) -->
                            <p
                                class="text-3xl font-extrabold 
                            {% if 'L·ªñI' in prediction_result %} text-red-600 bg-red-50 {% else %} text-green-600 bg-green-50 {% endif %} 
                            p-3 rounded-xl text-center">
                                {{ prediction_result }}
                            </p>
                        </div>
                        {% else %}
                        <!-- TR∆Ø·ªúNG H·ª¢P BAN ƒê·∫¶U HO·∫∂C SAU KHI T·∫¢I XU·ªêNG CSV TH√ÄNH C√îNG -->
                        <p class="text-gray-500 italic">
                            K·∫øt qu·∫£ d·ª± ƒëo√°n s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y sau khi b·∫°n nh·∫≠p
                            d·ªØ li·ªáu
                            th·ªß c√¥ng v√† b·∫•m "Ch·∫°y D·ª± ƒêo√°n".
                            <br><br>
                            *L∆∞u √Ω: N·∫øu b·∫°n s·ª≠ d·ª•ng t·ªáp CSV th√†nh c√¥ng, k·∫øt qu·∫£
                            s·∫Ω
                            ƒë∆∞·ª£c t·∫£i xu·ªëng tr·ª±c ti·∫øp d∆∞·ªõi d·∫°ng t·ªáp m·ªõi v√† kh√¥ng
                            hi·ªÉn
                            th·ªã tr√™n giao di·ªán n√†y.
                        </p>
                        {% endif %}
                    </div>
                </div>

            </form>

        </div>

    </body>

</html>
